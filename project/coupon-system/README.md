##요구사항 정의

선착순 100명에게 할인 쿠폰을 제공하는 이벤트를 진행하고자 합니다.

이 이벤트는 아래와 같은 조건을 만족해야 한다.
- 선착순 100명에게만 지급되어야 한다.
- 101개 이상이 지급되면 안된다.
- 순간적으로 몰리는 트래픽을 버틸 수 있어야 합니다.

---

## 그냥 로직 작성시 발생하는 문제점

###레이스 컨디션 발생 (Race Condition)
다중 스레드 또는 다중 프로세스 환경에서 발생하는 동시성 문제입니다.
이러한 문제는 여러 개의 스레드나 프로세스가 공유 자원에 동시에 접근하고 수정할 때, 실행 순서에 따라 결과가 올바르지 않게 나타는 상황을 말합니다.

###해결 방안
Redis를 활용하여서 레이스 컨디션 해결
- Redis는 단일 스레드 모델을 사용하여,
한 번에 하나의 요청만 처리합니다. 이를 통해 자체적으로 동시성 문제를 피하고자 합니다.
- 원자성(Atomicity) : Redis는 명령어 수준에서 여러 연산을 하나의 원자적 작업으로 처리하는 기능을 지원합니다.
예를 들어 "incr coupon_count" 명령어로 카운터를 증가시키는 경우, 이 명령어는 원자적으로 수행되므로 여러 클라이언트가 동시에 접근해도 결과가 올바르게 나옵니다.
하지만 여러 클라이언트가 동시에 접근하는 상황에서는 여전히 레이스 컨디션 문제가 발생할 수 있습니다.
- 현재 상황에 문제점 : RDBMS에 쿠폰을 저장 하는 형태여서 한번에 많은 요청이 있으면 RDBS에 CPU 사용량이 많아져서 서비스의 오류가 될수 있습니다.

kafka를 사용해서 Redis의 문제점을 보완할 수 있습니다.
- kafka는 분산형 스트리밍 플랫폼으로 데이터를 처리하고, 이벤트 스트리밍 아키텍처를 구현하는데에 적합합니다.
메세지 큐 방법을 사용하여 스트리밍 데이터르 처리를 수행하면 문제를 해결할 수 있습니다.

1. Producer: Redis에서 생성된 데이터를 생성하는 주체입니다. Redis에 새로운 데이터가 생성되면, 이를 Kafka 토픽으로 발행(Publish)하는 역할을 수행합니다.

2. Kafka Topic: Kafka 토픽은 데이터를 저장하는 주제(Subject)를 나타냅니다. Redis에서 생성된 데이터가 이 토픽으로 발행됩니다.

3. Kafka Consumer: Kafka 토픽을 구독(Subscribe)하는 주체입니다. Redis에서 생성된 데이터가 Kafka 토픽에 저장되면, 이 데이터를 읽어와서 다른 처리를 수행하는 역할을 합니다.

4. DB: Kafka Consumer가 데이터를 읽어온 후, 이를 데이터베이스(DB)에 저장하는 역할을 수행합니다.